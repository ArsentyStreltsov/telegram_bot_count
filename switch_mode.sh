#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Ä–µ–∂–∏–º–∞–º–∏
echo "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –±–æ—Ç–∞"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "main.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: main.py –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:"
echo "1) üß™ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–æ–¥–∞–∫—à–µ–Ω)"
echo "2) üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π)"
echo "3) üìä –°—Ç–∞—Ç—É—Å (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ)"
echo "4) üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ"
echo ""
read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-4): " choice

case $choice in
    1)
        echo "üß™ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ..."
        echo "‚ö†Ô∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞..."
        pkill -f "python main.py" 2>/dev/null
        
        echo "üìù –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
        if [ -f ".env" ]; then
            cp .env .env.backup
            echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è .env —Å–æ–∑–¥–∞–Ω–∞"
        fi
        
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç..."
        ./test_local.sh
        ;;
    2)
        echo "üöÄ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω..."
        echo "‚ö†Ô∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç..."
        pkill -f "python main.py" 2>/dev/null
        
        echo "üì§ –î–µ–ø–ª–æ–∏–º –Ω–∞ Railway..."
        ./deploy.sh
        ;;
    3)
        echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å..."
        local_processes=$(ps aux | grep "python main.py" | grep -v grep | wc -l)
        if [ $local_processes -gt 0 ]; then
            echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç –∑–∞–ø—É—â–µ–Ω ($local_processes –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)"
        else
            echo "‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"
        fi
        
        echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Railway Dashboard –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –±–æ—Ç–∞"
        echo "üåê https://railway.app/dashboard"
        ;;
    4)
        echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞..."
        pkill -f "python main.py" 2>/dev/null
        echo "‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
        echo "üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Railway Dashboard"
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 4."
        exit 1
        ;;
esac
